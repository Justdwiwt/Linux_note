# Linux

- [ ] 进程
- [ ] vim

## 进程

### 进程概述

> 进程是程序的具体实现，执行程序的具体过程

![](img/进程.png)

每执行一个程序或命令就可以启动一个进程，进程启动时，操作系统为其分配相对应的系统内唯一的进程`ID`（`PID`）

### 查看进程

> `ps -aux`

| 选项   | 参数                                |
| :----- | :---------------------------------- |
| -a     | 关联所有的process，通常与-x一起使用 |
| &nbsp; | 列出完整信息                        |
| -x     | 后台进程，通常与-a一起使用          |
| -u     | 有效使用者相关的process             |

#### 常用组合

* `ps -aux`：观察系统所有的程序数据
* `ps -axjf`：可以用类似于树状的形式显示
* `ps -l`：仅查看自己的`bash`相关的进程

#### Linux进程状态

| 状态   | 描述                       |
| ------ | -------------------------- |
| D      | 不可中断                   |
| R      | 正在运行，或在队列中的进程 |
| S      | 处于休眠状态               |
| T      | 停止或被追踪               |
| Z      | 僵尸进程                   |
| W      | 进入内存交换               |
| &nbsp; | 从内核2.6开始无效          |
| X      | 死掉的进程                 |
| <      | 高优先级                   |
| N      | 低优先级                   |
| s      | 包含子进程                 |
| +      | 位于后台的进程组           |

#### 僵尸进程

通常造成僵尸进程的原因是该进程应该已经执行完毕，或者是因故障应该要终止，但该进程的父进程却无法完整、有效的将进程结束掉，而造成进程一直存在内存当中。
如果发现在某个进程的CMD后面还接上`<defunct>`时，就代表该进程是 **僵尸进程**

#### top动态观察进程的变化

> `ps`是截取一个时间点的进程状态，而`top`则可以持续观察进程运行的状态

| 选项   | 参数                                         |
| ------ | -------------------------------------------- |
| -d     | 后面可以接秒数，即整个程序画面更新的秒数     |
| &nbsp; | 默认$5$秒                                    |
| -b     | 以批次的方式执行`top`                        |
| &nbsp; | 通常会搭配数据流重导向来将批次结果输出成档案 |
| -n     | 与`-b`搭配，需要进行几次`top`的输出结果      |
| -p     | 指定某些PID来进行观察检测                    |

* `top`默认使用CPU使用率作为排序的重点
* 按下`M`，使用内存使用率排序，恢复按下`P`

#### pstree查看进程树

| 选项 | 参数                                   |
| ---- | -------------------------------------- |
| -A  | 各程序树之间的连接以ASCII连接          |
| -U  | 各程序树之间的连接以万国码的字符来连接 |
| -p   | 同时列出每个process的PID               |
| -u   | 同时列出每个process的所属账号名称      |

### 进程管理

#### KIll发送信号

| 选项   | 参数                                                 |
| ------ | ---------------------------------------------------- |
| -l     | 列出目前`kill`能够使用的信号                           |
| -$15$    | 以正常的程序方式终止一个进程                         |
| -$9$     | 立刻强制终止一个进程                                 |
| -$2$     | 代表由键盘输入`ctrl -C`同样的动作                    |
| -$1$    | 对应`sshd`这样的守护进程，重新读取一次参数的配置文件 |
| &nbsp; | 如果进程为非守护进程，默认终止进程                   |

### 系统资源监控

* `free`：观察内存使用情况
* `uname`：查阅系统与核心相关信息
* `uptime`：观察系统启动时间与工作负载
* `netstat`：网络监控
* `vmstat`：侦测系统资源变化

#### free

| 选项 | 参数                                   |
| ---- | -------------------------------------- |
| -b   | 定义显示单位                           |
| -t   | 输出最终结果时，显示物理内存与swap总量 |

#### uname

| 选项 | 参数                   |
| ---- | ---------------------- |
| -a   | 列出所有系统相关的信息 |
| -s   | 系统内核名称           |
| -r   | 内核版本               |
| -m   | 本系统的硬件名称       |
| -p   | CPU的类型              |
| -i   | 硬件的平台             |

#### uptime

> 显示目前系统当前时间、已经开机多长时间、用户数、以及1、5、15分钟的平均负载

#### netstat

| 选项 | 参数                                                 |
| ---- | ---------------------------------------------------- |
| -a   | 将目前系统上所有的已经连接、监听、Socket数据都列出来 |
| -t   | 列出tcp网络包的信息                                  |
| -u   | 列出udp网络包的信息                                  |
| -n   | 以端口方式来显示                                     |
| -l   | 列出目前正在监听的服务                               |
| -p   | 列出该网络服务的进程id                               |

* `service iptables start`：启动防火墙
* `service iptables status`：防火墙状态查看
* `service iptables stop`：关闭防火墙
* `service iptables restart`：重启防火墙
* `chkconfig iptables off`：永久关闭防火墙
* `chkconfig iptables on`：永久开启防火墙
* **重启生效**

#### vmstat

| 选项 | 参数                                              |
| ---- | ------------------------------------------------- |
| -a   | 使用`inactive/active`取代`buffer/cache`的内存输出信息 |
| -f   | 开机到目前为止，系统复制的进程数                  |
| -s   | 将一些事件导致的内存变化情况列表说明              |
| -S   | 后面可以接单位，让显示的数据有单位                |
| -d   | 列出磁盘的读写总量统计表                          |
| -p   | 列出磁盘分区，显示该磁盘分区的读写总量统计        |

### 任务管理

登录bash后，会取得一个名为bash的进程，在这个环境中所执行的其他指令，几乎都是所谓的子进程。

* 前台：可以控制与执行命令的bash环境称为前台进程
* 后台：在操作系统中自动运行，无法使用`ctrl + C`终止，可以使用`bg/fg`命令操作的任务。
    * 可以通过`jobs`命令查看后台执行的任务（非系统进程）。
    * 可以通过`ctrl + Z`将前台执行的任务放置后台。

#### ctrl + Z 和 & 的区别

* `ctrl + Z`将前台程序放置后台：**暂停**
* 在执行的命令后面追加`&`：**后台运行**

#### jobs

| 选项 | 参数                                     |
| ---- | ---------------------------------------- |
| -l   | 列出job number 与指令串，同时列出PID号码 |
| -r   | 列出正在后台run的任务                    |
| -s   | 列出正在后台stop的任务                   |

#### fg

> 将后台拿到前台执行

#### nohup

> 脱机或注销后仍能让工作继续进行

* `nohup [命令参数]`：在当前终端前台执行
* `nohup [命令参数] &`：在后台执行

## vim命令

### vim的三种模式

#### 一般模式

默认模式，可以使用上下左右移动光标来移动，也可以使用删除字符或删除整行来处理文件内容，也可以使用复制粘贴来处理文件数据。
**但无法任意编辑文件内容**

#### 编辑模式

在一般模式中可以删除、复制、粘贴等，按下`i`、`I`、`o`、`O`、`a`、`A`、`r`、`R`等任何一个字母后进入编辑模式，并在左下方出现`INSERT`或者`REPLACE`。

| 选项 | 参数                         |
| ---- | ---------------------------- |
| -i   | 在光标所处位进行编辑         |
| -I   | 在光标所处位的行首进行编辑   |
| -o   | 在光标所处行的下行进行编辑   |
| -O   | 在光标所处行的上行进行编辑   |
| -a   | 在光标所处位的后面进行追加   |
| -A   | 在光标所处位的行尾进行追加   |
| -r   | 修改光标所在处的一个字符     |
| -R   | 从光标所处位直接往后进行修改 |

* 在该模式下输入文件内容
* 按下`ESC`返回一般模式

#### 命令模式

在一般模式中，输入`:`、`/`、`?`三个字符中的任何一个按钮，就可以将光标移动到最下面那一行。

* 在这个模式中，可以提供 **查询** 、**替换** 等功能。
* **存盘** 、 **离开** 、 **显示行号** 等命令都是在此模式下进行。
